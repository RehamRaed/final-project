[{"filePath":"C:\\Users\\af199\\Desktop\\final-project\\src\\app\\(student)\\courses\\[courseId]\\lessons\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1409,1412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1409,1412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getCourseLessonsAction } from \"@/actions/learning.actions\";\r\nimport { Metadata } from 'next';\r\nimport LessonPageClient from \"@/components/lessons/LessonPageClient\";\r\nimport ErrorState from \"@/components/ui/ErrorState\";\r\n\r\ninterface LessonsPageProps {\r\n  params: Promise<{ courseId: string }>;\r\n}\r\n\r\nexport async function generateMetadata({ params }: LessonsPageProps): Promise<Metadata> {\r\n  const { courseId } = await params;\r\n  return {\r\n    title: `Lessons | Course ${courseId}`,\r\n    description: `Start learning with our interactive lessons.`,\r\n  };\r\n}\r\n\r\nexport default async function LessonsPage({ params }: LessonsPageProps) {\r\n  const { courseId } = await params;\r\n\r\n  const result = await getCourseLessonsAction(courseId);\r\n\r\n  if (!result.success) {\r\n    return (\r\n      <main className=\"min-h-screen max-w-[1400px] mx-auto px-5 pt-30\">\r\n        <ErrorState\r\n          title=\"Course Not Found\"\r\n          message=\"Sorry, we could not load the lessons for this course.\"\r\n          details={result.error}\r\n        />\r\n      </main>\r\n    );\r\n  }\r\n\r\n  const courseData = result.data;\r\n\r\n  if (!courseData) {\r\n    return (\r\n      <main className=\"min-h-screen max-w-[1400px] mx-auto px-5 pt-30\">\r\n        <ErrorState\r\n          title=\"No Data\"\r\n          message=\"No course data available.\"\r\n        />\r\n      </main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <LessonPageClient courseData={courseData as any} />\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\af199\\Desktop\\final-project\\src\\app\\(student)\\roadmaps\\[roadmapId]\\courses\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[271,274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[271,274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from \"@/lib/supabase/server\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { Tables } from \"@/types/database.types\";\r\nimport CourseCard from \"@/components/StudentRoadmap/CourseCard\";\r\n\r\nasync function calculateCourseProgress(\r\n  supabase: any,\r\n  courseId: string,\r\n  userId: string\r\n): Promise<number> {\r\n  const { data: lessons } = await supabase\r\n    .from(\"lessons\")\r\n    .select(\"id\")\r\n    .eq(\"course_id\", courseId);\r\n\r\n  if (!lessons || lessons.length === 0) return 0;\r\n\r\n  const lessonIds = lessons.map((l: { id: string }) => l.id);\r\n  const { data: progress } = await supabase\r\n    .from(\"user_lesson_progress\")\r\n    .select(\"status\")\r\n    .eq(\"user_id\", userId)\r\n    .in(\"lesson_id\", lessonIds);\r\n\r\n  if (!progress) return 0;\r\n\r\n  const completedCount = progress.filter(\r\n    (p: { status: string | null }) => p.status === \"completed\"\r\n  ).length;\r\n  return Math.round((completedCount / lessons.length) * 100);\r\n}\r\n\r\ninterface Course extends Tables<'courses'> {\r\n  course_id: string;\r\n  summary: string | null;\r\n  donePercentage: number;\r\n}\r\n\r\ninterface PageProps {\r\n  params: Promise<{ roadmapId: string }>;\r\n}\r\n\r\nexport default async function RoadmapCoursesPage({ params }: PageProps) {\r\n  const { roadmapId } = await params;\r\n  const supabase = await createClient();\r\n\r\n  // 1. Get User\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser();\r\n\r\n  if (userError || !user) {\r\n    redirect(\"/login\");\r\n  }\r\n\r\n  const { data: roadmap } = await supabase\r\n    .from(\"roadmaps\")\r\n    .select(\"*\")\r\n    .eq(\"id\", roadmapId)\r\n    .single();\r\n\r\n  if (!roadmap) {\r\n    redirect(\"/roadmaps\");\r\n  }\r\n\r\n  const { data: coursesData, error: coursesError } = await supabase\r\n    .from(\"roadmap_courses\")\r\n    .select(\r\n      `\r\n      course_id,\r\n      order_index,\r\n      courses!inner (\r\n        *\r\n      )\r\n    `\r\n    )\r\n    .eq(\"roadmap_id\", roadmapId)\r\n    .order(\"order_index\", { ascending: true });\r\n\r\n  if (coursesError) {\r\n    console.error(\"Error fetching courses:\", coursesError);\r\n  }\r\n\r\n  const courses: Course[] = [];\r\n  if (coursesData) {\r\n    for (const c of coursesData) {\r\n      const progress = await calculateCourseProgress(\r\n        supabase,\r\n        c.course_id,\r\n        user.id\r\n      );\r\n      const courseData = c.courses as unknown as Tables<'courses'> & { summary: string | null };\r\n      courses.push({\r\n        ...courseData,\r\n        course_id: c.course_id,\r\n        summary: courseData.summary || null,\r\n        donePercentage: progress,\r\n      });\r\n    }\r\n  }\r\n\r\n  const doneCount = courses.filter((c) => c.donePercentage === 100).length;\r\n\r\n  return (\r\n    <div className=\"min-h-screen max-w-[1400px] mx-auto px-10 py-25 flex flex-col gap-6 bg-bg\">\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-center mb-4 gap-4\">\r\n        <h2 className=\"font-bold text-primary lg:text-2xl md:text-xl\">\r\n          {roadmap.title} - Courses\r\n        </h2>\r\n        <div className=\"text-sm text-text-secondary\">\r\n          {doneCount} of {courses.length} completed\r\n        </div>\r\n      </div>\r\n\r\n      {courses.length === 0 ? (\r\n        <div className=\"text-center py-20\">\r\n          <p className=\"text-gray-500 text-lg mb-2\">No courses found</p>\r\n          <p className=\"text-gray-400 text-sm\">\r\n            This roadmap doesn&apos;t have any courses yet.\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 gap-6 mt-4\">\r\n          {courses.map((course) => (\r\n            <CourseCard\r\n              key={course.course_id}\r\n              course={course}\r\n              href={`/courses/${course.course_id}`}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\af199\\Desktop\\final-project\\src\\app\\student\\roadmaps\\[roadmapId]\\courses\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4834,4837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4834,4837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"@/store\";\r\nimport { supabase } from '@/lib/supabase/client';\r\nimport CourseCard from \"@/components/StudentRoadmap/CourseCard\";\r\n\r\nimport { Tables } from \"@/types/database.types\";\r\n\r\ninterface Course extends Tables<'courses'> {\r\n  course_id: string; // The ID from roadmap_courses\r\n  donePercentage: number;\r\n  summary: string | null;\r\n}\r\n\r\nexport default function RoadmapCoursesPage() {\r\n  const currentRoadmap = useSelector(\r\n    (state: RootState) => state.roadmap.current\r\n  );\r\n\r\n  const [courses, setCourses] = useState<Course[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showDoneOnly, setShowDoneOnly] = useState(false);\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  //Get logged-in user\r\n  // Load logged-in user\r\n  useEffect(() => {\r\n    const loadUser = async () => {\r\n      const { data, error } = await supabase.auth.getUser();\r\n      if (error || !data.user) {\r\n        console.error('User not authenticated');\r\n        return;\r\n      }\r\n      setUserId(data.user.id);\r\n    };\r\n\r\n    loadUser();\r\n  }, []); // no dependency on currentRoadmap\r\n\r\n  useEffect(() => {\r\n    if (!currentRoadmap?.id || !userId) return; // wait for both\r\n\r\n    const fetchCourses = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const { supabase } = await import(\"@/lib/supabase/client\");\r\n\r\n        const { data: coursesData, error: coursesError } = await supabase\r\n          .from(\"roadmap_courses\")\r\n          .select(`\r\n          course_id,\r\n          order_index,\r\n          courses!inner (\r\n            title,\r\n            description,\r\n            summary,\r\n            instructor\r\n          )\r\n        `)\r\n          .eq(\"roadmap_id\", currentRoadmap.id)\r\n          .order(\"order_index\", { ascending: true });\r\n\r\n        if (coursesError) throw coursesError;\r\n\r\n        //Fetch user_course_progress for these courses\r\n        const courseIds = coursesData.map(c => c.course_id);\r\n        const { data: progressData, error: progressError } = await supabase\r\n          .from(\"user_course_progress\")\r\n          .select(\"course_id, done_percentage\")\r\n          .eq(\"user_id\", userId)\r\n          .in(\"course_id\", courseIds);\r\n\r\n        if (progressError) throw progressError;\r\n\r\n        //Merge data\r\n        const formatted: Course[] = coursesData.map((c) => {\r\n          const course = c.courses as unknown as Tables<'courses'>;\r\n          const progress = progressData.find(p => p.course_id === c.course_id);\r\n          return {\r\n            ...course,\r\n            course_id: c.course_id,\r\n            donePercentage: progress?.done_percentage ?? 0,\r\n          };\r\n        });\r\n\r\n        setCourses(formatted);\r\n\r\n      } catch (err: unknown) {\r\n        const message = err instanceof Error ? err.message : 'Unknown error';\r\n        console.error(\"Error fetching courses:\", message);\r\n        setCourses([]);\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    fetchCourses();\r\n  }, [currentRoadmap, userId]);\r\n\r\n  if (!currentRoadmap) {\r\n    return (\r\n      <p className=\"text-center py-10 text-gray-500\">\r\n        Please select a roadmap first.\r\n      </p>\r\n    );\r\n  }\r\n\r\n  const filteredCourses = showDoneOnly\r\n    ? courses.filter((c) => c.donePercentage === 100)\r\n    : courses;\r\n\r\n  const doneCount = courses.filter((c) => c.donePercentage === 100).length;\r\n\r\n  return (\r\n    <div className=\"min-h-screen max-w-[1400px] mx-auto px-10 py-25 flex flex-col gap-6 bg-bg\">\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-center mb-4 gap-4\">\r\n        <h2 className=\"font-bold text-primary lg:text-2xl md:text-xl\">\r\n          My Roadmap Courses\r\n          {showDoneOnly && (\r\n            <span className=\"text-green-500 text-sm ml-2\">\r\n              / Done Courses ({doneCount})\r\n            </span>\r\n          )}\r\n        </h2>\r\n\r\n        <button\r\n          onClick={() => setShowDoneOnly(!showDoneOnly)}\r\n          className={`px-4 py-2 rounded-lg text-white font-medium transition ${showDoneOnly\r\n            ? \"bg-gray-500\"\r\n            : \"bg-primary hover:opacity-90\"\r\n            }`}\r\n        >\r\n          {showDoneOnly ? \"Show All\" : \"Filter Done\"}\r\n        </button>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <p className=\"text-center py-10 text-gray-500\">\r\n          Loading courses...\r\n        </p>\r\n      ) : filteredCourses.length === 0 ? (\r\n        <p className=\"text-center py-10 text-gray-500\">\r\n          {showDoneOnly\r\n            ? \"No completed courses found.\"\r\n            : \"No courses found for this roadmap.\"}\r\n        </p>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 gap-6 mt-4\">\r\n          {filteredCourses.map((course) => (\r\n            <CourseCard key={course.course_id} course={course as any} href={`/roadmaps/${currentRoadmap.id}/courses/${course.course_id}`} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\af199\\Desktop\\final-project\\src\\context\\ThemeContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\af199\\Desktop\\final-project\\src\\context\\ThemeContext.tsx:19:7\n  17 |     const saved = localStorage.getItem(\"theme\");\n  18 |     if (saved === \"dark\") {\n> 19 |       setDark(true);\n     |       ^^^^^^^ Avoid calling setState() directly within an effect\n  20 |     }\n  21 |     setMounted(true);\n  22 |   }, []);","line":19,"column":7,"nodeType":null,"endLine":19,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { createContext, useEffect, useState } from \"react\";\r\n\r\ntype ThemeContextType = {\r\n  dark: boolean;\r\n  toggleTheme: () => void;\r\n};\r\n\r\nexport const ThemeContext = createContext<ThemeContextType | null>(null);\r\n\r\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\r\n  const [dark, setDark] = useState(false);\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"theme\");\r\n    if (saved === \"dark\") {\r\n      setDark(true);\r\n    }\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n\r\n    if (dark) {\r\n      document.documentElement.classList.add(\"dark\");\r\n      localStorage.setItem(\"theme\", \"dark\");\r\n    } else {\r\n      document.documentElement.classList.remove(\"dark\");\r\n      localStorage.setItem(\"theme\", \"light\");\r\n    }\r\n  }, [dark, mounted]);\r\n\r\n  const toggleTheme = () => setDark(prev => !prev);\r\n\r\n  if (!mounted) return null;\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ dark, toggleTheme }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]}]
